class SitePE { constructor() { this.storageKey = 'sitepe_progress'; this.progress = { modules: {}, examHistory: [] }; this.init() } async init() { console.log('üöÄ Initialisation...'); await this.loadData(); this.loadProgress(); this.setupUI() } async loadData() { try { this.data = { site: await fetch('/data/site.json').then(r => r.json()), qcm: await fetch('/data/qcm.json').then(r => r.json()), exercises: await fetch('/data/exercises.json').then(r => r.json()), problems: await fetch('/data/navigation-problems.json').then(r => r.json()) } } catch (e) { console.error('Erreur load:', e) } } loadProgress() { const s = localStorage.getItem(this.storageKey); this.progress = s ? JSON.parse(s) : { modules: {}, examHistory: [] } } saveProgress() { localStorage.setItem(this.storageKey, JSON.stringify(this.progress)) } setupUI() { document.querySelectorAll('[data-qcm-start]').forEach(b => b.onclick = () => this.startQCM(b.dataset.qcmModule)); document.querySelectorAll('[data-flashcard-start]').forEach(b => b.onclick = () => this.startFlashcards(b.dataset.fcModule)); this.updateDashboard() } updateDashboard() { const progress = Object.values(this.progress.modules).reduce((a, b) => (a + b.progress) / 2, 0) || 0; if (document.querySelector('[data-progress-bar]')) { document.querySelector('[data-progress-bar]').style.width = progress + '%'; document.querySelector('[data-progress-text]').textContent = Math.round(progress) + '%' } } startQCM(moduleFilter = null) { let q = this.data.qcm.questions; if (moduleFilter) q = q.filter(x => x.moduleId == moduleFilter); this.qcm = { q: q.sort(() => Math.random() - 0.5), idx: 0, answers: [], start: Date.now(), score: 0, errors: 0 }; this.displayQCM() } displayQCM() { const q = this.qcm.q[this.qcm.idx]; if (!q) { this.endQCM(); return } const html = `<div class="qcm-question"><div class="progress mb-3"><div class="progress-bar" style="width:${(this.qcm.idx + 1) / this.qcm.q.length * 100}%"></div></div><h5>${this.qcm.idx + 1}/${this.qcm.q.length}</h5><h4>${q.question}</h4><div class="options mt-4">${q.options.map((o, i) => `<div class="form-check"><input type="radio" name="ans" value="${i}" id="opt${i}"><label for="opt${i}">${o.text}</label></div>`).join('')}</div><button class="btn btn-primary mt-4" onclick="window.sitePE.nextQCM()">Suivant ‚Üí</button></div>`; document.getElementById('qcm-container').innerHTML = html } nextQCM() { const sel = document.querySelector('input[name="ans"]:checked'); if (!sel) return alert('S√©lectionne une r√©ponse'); const q = this.qcm.q[this.qcm.idx]; const ok = parseInt(sel.value) === q.options.findIndex(o => o.correct); this.qcm.score += ok ? 100 / this.qcm.q.length : 0; if (!ok) this.qcm.errors++; this.qcm.idx++; this.displayQCM() } endQCM() { const score = Math.round(this.qcm.score); const ok = score >= 75 && this.qcm.errors <= 5; const exam = { date: new Date().toLocaleString('fr'), score, errors: this.qcm.errors, passed: ok }; this.progress.examHistory.push(exam); this.saveProgress(); const html = `<div class="alert ${ok ? 'alert-success' : 'alert-danger'}"><h3>${ok ? '‚úÖ Bravo!' : '‚ùå Echec'}</h3><p><b>Score: ${score}/100</b></p><p>Erreurs: ${this.qcm.errors}/5</p><button class="btn btn-primary mt-3" onclick="location.reload()">Recommencer</button></div>`; document.getElementById('qcm-container').innerHTML = html } startFlashcards(moduleId) { const cards = this.data.exercises.flashcards.filter(f => f.moduleId == moduleId).sort(() => Math.random() - 0.5); if (!cards.length) return alert('Aucune flashcard'); this.fc = { cards, idx: 0, learned: [] }; this.displayFC() } displayFC() { const card = this.fc.cards[this.fc.idx]; if (!card) { alert(`‚úÖ ${this.fc.learned.length} cartes apprises!`); return } const flipped = document.getElementById('fc-card')?.dataset.flipped === 'true' || false; const html = `<div class="card" id="fc-card" data-flipped="false" style="min-height:300px;cursor:pointer;" onclick="const c=this;c.dataset.flipped=(c.dataset.flipped==='false'?'true':'false');window.sitePE.displayFC()"><div class="card-body d-flex align-items-center justify-content-center"><h3 class="text-center">${flipped ? card.answer : card.question}</h3></div></div><div class="progress mb-3"><div class="progress-bar" style="width:${(this.fc.idx + 1) / this.fc.cards.length * 100}%"></div></div><div class="btn-group w-100"><button class="btn btn-danger" onclick="window.sitePE.nextFC(false)">Difficile</button><button class="btn btn-warning" onclick="window.sitePE.nextFC(false)">R√©viser</button><button class="btn btn-success" onclick="window.sitePE.nextFC(true)">Acquis ‚úì</button></div>`; document.getElementById('flashcards-container').innerHTML = html } nextFC(ok) { if (ok) this.fc.learned.push(this.fc.cards[this.fc.idx].id); this.fc.idx++; this.displayFC() } calcTide(pm, bm, pmTime, queryTime) { const diff = Math.abs((queryTime - pmTime) / 3600000); if (diff > 6) return bm; const rule = [1 / 12, 2 / 12, 3 / 12, 3 / 12, 2 / 12, 1 / 12]; const marnage = pm - bm; let height = bm; for (let i = 0; i < Math.floor(diff); i++)height += rule[i] * marnage; return Math.round(height * 100) / 100 } calcCourse(cc, decl, dev) { return cc + decl + dev } calcDrift(cv, windAngle, windSpeed) { return cv + (windSpeed * Math.sin(windAngle * Math.PI / 180)) * 0.1 } } window.sitePE = new SitePE();
