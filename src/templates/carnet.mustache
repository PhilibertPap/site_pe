<section class="page-hero mb-4 reveal">
    <div class="row g-3 align-items-center">
        <div class="col-lg-8">
            <h1 class="display-6 mb-2">Carnet de bord</h1>
            <p class="mb-0">Toutes les fiches de revision sont disponibles module par module.</p>
        </div>
        <div class="col-lg-4">
            <div class="soft-panel p-3 reveal reveal-delay-1">
                <p class="kpi-label">Fiches disponibles</p>
                <p class="kpi-value mb-0">{{completedModulesCount}} / {{totalModulesCount}}</p>
            </div>
        </div>
    </div>
</section>

<div class="row g-4 mb-5 reveal reveal-delay-1">
    <section class="col-lg-6">
        <div class="card h-100">
            <div class="card-header bg-success text-white">
                <h2 class="h5 mb-0 section-head"><span class="icon-badge">SF</span>Sommaire des fiches</h2>
            </div>
            <div class="card-body">
                <div class="list-group">
                    {{#modules}}
                    <a href="#fiche-{{id}}" class="list-group-item list-group-item-action">
                        Module {{moduleNumber}} - {{name}}
                    </a>
                    {{/modules}}
                </div>
            </div>
        </div>
    </section>

    <section class="col-lg-6">
        <div class="card h-100">
            <div class="card-header bg-info text-white">
                <h2 class="h5 mb-0 section-head"><span class="icon-badge">PR</span>Impression</h2>
            </div>
            <div class="card-body">
                <p class="mb-3">Selectionne les fiches a imprimer :</p>
                <form class="soft-panel p-3">
                    {{#modules}}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="fiche-check-{{id}}" value="{{id}}" checked>
                        <label class="form-check-label" for="fiche-check-{{id}}">Module {{moduleNumber}} - {{name}}</label>
                    </div>
                    {{/modules}}
                </form>
                <button class="btn btn-info mt-3 w-100" onclick="printSelectedFiches()">Imprimer les fiches selectionnees</button>
            </div>
        </div>
    </section>
</div>

<section id="fiches-content" class="reveal reveal-delay-2">
    {{#modules}}
    <article id="fiche-{{id}}" class="fiche-printable mb-5 p-4 border">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
            <div>
                <h2 class="h4 mb-2">Module {{moduleNumber}} - {{name}}</h2>
                <p class="text-muted small mb-0">{{description}}</p>
            </div>
            <a href="{{coursePage}}" class="btn btn-outline-primary btn-sm">Page de cours</a>
        </div>
        <hr class="my-3">

        <h3 class="h6"><strong>Objectifs cles</strong></h3>
        <ul class="small mb-3">
            {{#objectifs}}
            <li>{{.}}</li>
            {{/objectifs}}
        </ul>

        <h3 class="h6"><strong>Checklist</strong></h3>
        <ul class="small mb-3">
            {{#checklist}}
            <li>{{.}}</li>
            {{/checklist}}
        </ul>

        {{#hasFormulas}}
        <h3 class="h6"><strong>Formules / reperes</strong></h3>
        <pre class="small bg-light p-2 rounded"><code>{{formulas}}</code></pre>
        {{/hasFormulas}}

        <p class="small mb-0"><strong>QCM module:</strong> {{qcmQuestionCount}} â€¢ <strong>Annales {{annalesDomainLabel}}:</strong> {{annalesCount}}</p>
    </article>
    {{/modules}}
</section>

<script>
function printSelectedFiches() {
    const selectedIds = new Set();
    document.querySelectorAll('.form-check-input:checked').forEach(checkbox => selectedIds.add(checkbox.value));
    if (selectedIds.size === 0) {
        alert('Selectionne au moins une fiche');
        return;
    }

    document.querySelectorAll('#fiches-content article').forEach(article => {
        const id = article.id.replace('fiche-', '');
        article.style.display = selectedIds.has(id) ? '' : 'none';
    });

    window.print();

    document.querySelectorAll('#fiches-content article').forEach(article => {
        article.style.display = '';
    });
}
</script>

<style media="print">
nav, footer, .form-check, .btn, .page-hero { display: none !important; }
body { background: white; }
</style>
