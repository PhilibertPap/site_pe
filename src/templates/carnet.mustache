<section class="page-hero mb-4 reveal">
    <div class="row g-3 align-items-center">
        <div class="col-lg-8">
            <h1 class="display-6 mb-2">Carnet de bord</h1>
            <p class="mb-0">Pr√©pare des fiches de r√©vision imprimables pour les modules valid√©s.</p>
        </div>
        <div class="col-lg-4">
            <div class="soft-panel p-3 reveal reveal-delay-1">
                <p class="kpi-label">Modules valid√©s</p>
                <p class="kpi-value mb-0">{{completedModulesCount}} / {{totalModulesCount}}</p>
            </div>
        </div>
    </div>
</section>

<div class="row g-4 mb-5 reveal reveal-delay-1">
    <section class="col-lg-6 reveal reveal-delay-2">
        <div class="card h-100">
            <div class="card-header bg-success text-white">
                <h2 class="h5 mb-0 section-head"><span class="icon-badge">üìö</span>Fiches disponibles</h2>
            </div>
            <div class="card-body">
                <div class="list-group">
                    {{#modules}}
                    {{#isCompleted}}
                    <a href="#fiche-{{id}}" class="list-group-item list-group-item-action">‚úÖ {{name}}</a>
                    {{/isCompleted}}
                    {{^isCompleted}}
                    <span class="list-group-item text-muted">üîí {{name}} (√† compl√©ter)</span>
                    {{/isCompleted}}
                    {{/modules}}
                </div>
            </div>
        </div>
    </section>

    <section class="col-lg-6 reveal reveal-delay-3">
        <div class="card h-100">
            <div class="card-header bg-info text-white">
                <h2 class="h5 mb-0 section-head"><span class="icon-badge">üñ®Ô∏è</span>Impression</h2>
            </div>
            <div class="card-body">
                <p class="mb-3">S√©lectionne les fiches √† imprimer :</p>
                <form class="soft-panel p-3">
                    {{#modules}}
                    {{#isCompleted}}
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="fiche-check-{{id}}" value="{{id}}" checked>
                        <label class="form-check-label" for="fiche-check-{{id}}">{{name}}</label>
                    </div>
                    {{/isCompleted}}
                    {{/modules}}
                </form>
                <button class="btn btn-info mt-3 w-100" onclick="printSelectedFiches()">Imprimer les fiches s√©lectionn√©es</button>
            </div>
        </div>
    </section>
</div>

<section id="fiches-content" class="reveal reveal-delay-4">
    {{#modules}}
    {{#isCompleted}}
    <article id="fiche-{{id}}" class="fiche-printable mb-5 p-4 border">
        <h2 class="h4 mb-2">{{name}}</h2>
        <p class="text-muted small"><strong>Module {{moduleNumber}}</strong> ‚Ä¢ {{description}}</p>
        <hr class="my-3">

        <h3 class="h6"><strong>Objectifs cl√©s</strong></h3>
        <ul class="small mb-3">
            {{#objectifs}}
            <li>{{.}}</li>
            {{/objectifs}}
        </ul>

        <h3 class="h6"><strong>Points √† retenir</strong></h3>
        <ul class="small mb-3">
            {{#keyPoints}}
            <li>{{.}}</li>
            {{/keyPoints}}
        </ul>

        <h3 class="h6"><strong>Formules / Concepts</strong></h3>
        <pre class="small bg-light p-2 rounded"><code>{{formulas}}</code></pre>

        <hr class="my-3">
        <p class="text-muted mb-0"><small>Carnet de bord - Pr√©paration PE - NDC</small></p>
    </article>
    {{/isCompleted}}
    {{/modules}}
</section>

<script>
function printSelectedFiches() {
    const selected = [];
    document.querySelectorAll('.form-check-input:checked').forEach(checkbox => {
        selected.push(checkbox.value);
    });
    if(selected.length === 0) {
        alert('S√©lectionne au moins une fiche');
        return;
    }
    // Affiche les fiches s√©lectionn√©es et lance l'impression
    window.print();
}
</script>

<style media="print">
    nav, footer, .form-check, .btn { display: none; }
    body { background: white; }
</style>
