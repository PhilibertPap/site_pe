<section class="page-hero mb-4 reveal">
    <div class="row g-3 align-items-center">
        <div class="col-lg-8">
            <h1 class="display-6 mb-2">Module {{moduleNumber}} - {{name}}</h1>
            <p class="mb-0">{{description}}</p>
        </div>
        <div class="col-lg-4 text-lg-end">
            <a href="parcours.html#module-{{id}}" class="btn btn-light btn-sm">Retour au parcours</a>
            <a href="session.html?mode=exam-module&module={{id}}" class="btn btn-outline-light btn-sm ms-2">Examen module</a>
        </div>
    </div>
</section>

<div class="row g-4">
    <section class="col-lg-8 reveal reveal-delay-1">
        <article class="card h-100">
            <header class="card-header bg-light-subtle">
                <h2 class="h5 mb-0 section-head"><span class="icon-badge">CO</span>Cours complet</h2>
            </header>
            <div class="card-body course-content">
                {{#hasCourseSections}}
                <div class="row g-4">
                    <aside class="col-lg-4">
                        <div class="course-toc-panel">
                            <h3 class="h6 mb-2">Plan du cours</h3>
                            <div class="list-group list-group-flush">
                                {{#courseSections}}
                                <a href="#course-section-{{id}}" class="list-group-item list-group-item-action course-toc-link">
                                    {{title}}
                                </a>
                                {{/courseSections}}
                            </div>
                        </div>
                    </aside>
                    <div class="col-lg-8">
                        {{#courseSections}}
                        <section id="course-section-{{id}}" class="course-section-block mb-4">
                            <h3 class="h5 mb-2">{{title}}</h3>
                            <div class="course-section-html">
                                {{{html}}}
                            </div>
                        </section>
                        {{/courseSections}}
                    </div>
                </div>
                {{/hasCourseSections}}
                {{^hasCourseSections}}
                {{{courseContentHtml}}}
                {{/hasCourseSections}}
            </div>
        </article>

        <article class="card mt-4">
            <header class="card-header bg-light-subtle">
                <h2 class="h6 mb-0 section-head"><span class="icon-badge">CL</span>Checklist de revision</h2>
            </header>
            <div class="card-body">
                <div class="checklist-group" data-module-checklist="{{id}}">
                    {{#checklistEntries}}
                    <div class="form-check checklist-item">
                        <input class="form-check-input module-check-item" type="checkbox" id="module-{{moduleId}}-check-{{index}}" data-check-index="{{index}}">
                        <label class="form-check-label" for="module-{{moduleId}}-check-{{index}}">{{text}}</label>
                    </div>
                    {{/checklistEntries}}
                </div>
            </div>
        </article>
    </section>

    <aside class="col-lg-4 reveal reveal-delay-2">
        <article class="card mb-4">
            <header class="card-header bg-primary text-white">
                <h2 class="h6 mb-0 section-head"><span class="icon-badge">Q</span>Entrainement module</h2>
            </header>
            <div class="card-body">
                <p class="mb-2"><strong>Questions disponibles:</strong> {{qcmQuestionCount}}</p>
                <p class="mb-3"><strong>Annales {{annalesDomainLabel}}:</strong> {{annalesCount}}</p>
                <div class="d-grid gap-2">
                    <a href="session.html?mode=quick&module={{id}}" class="btn btn-primary">Lancer un QCM cible</a>
                    <a href="session.html?mode=exam-module&module={{id}}" class="btn btn-outline-primary">Lancer l'examen module</a>
                </div>
            </div>
        </article>

        {{#hasFormulas}}
        <article class="card mb-4">
            <header class="card-header bg-light-subtle">
                <h2 class="h6 mb-0 section-head"><span class="icon-badge">FX</span>Formules et reperes</h2>
            </header>
            <div class="card-body">
                <ul class="small mb-0">
                    {{#formulaRepereItems}}
                    <li>{{.}}</li>
                    {{/formulaRepereItems}}
                </ul>
            </div>
        </article>
        {{/hasFormulas}}

        {{#hasCourseIllustrations}}
        <article class="card mb-4">
            <header class="card-header bg-light-subtle">
                <h2 class="h6 mb-0 section-head"><span class="icon-badge">IM</span>Visuels representatifs</h2>
            </header>
            <div class="card-body">
                <div class="row g-2">
                    {{#courseIllustrations}}
                    <div class="col-12">
                        <img src="{{src}}" alt="{{alt}}" class="img-fluid rounded annales-thumb">
                    </div>
                    {{/courseIllustrations}}
                </div>
            </div>
        </article>
        {{/hasCourseIllustrations}}

        {{#hasAnnalesExamples}}
        <article class="card mb-4">
            <header class="card-header bg-light-subtle">
                <h2 class="h6 mb-0 section-head"><span class="icon-badge">AN</span>Exemples annales</h2>
            </header>
            <div class="card-body">
                {{#annalesExamples}}
                <div class="annales-example mb-3 pb-3 border-bottom">
                    <p class="small mb-2"><strong>Question {{questionNumber}}:</strong> {{question}}</p>
                    {{#hasImage}}
                    <img src="{{image}}" alt="Illustration annale question {{questionNumber}}" class="img-fluid rounded annales-thumb">
                    {{/hasImage}}
                </div>
                {{/annalesExamples}}
            </div>
        </article>
        {{/hasAnnalesExamples}}

        <article class="card">
            <header class="card-header bg-light-subtle">
                <h2 class="h6 mb-0 section-head"><span class="icon-badge">SA</span>Sessions annales</h2>
            </header>
            <div class="card-body">
                <ul class="list-group list-group-flush">
                    {{#annalesSeries}}
                    <li class="list-group-item px-0">
                        <strong>{{label}}</strong>
                        {{#hasCorrige}}<span class="badge text-bg-success ms-1">corrige</span>{{/hasCorrige}}
                        {{#answerKeyAvailable}}<span class="badge text-bg-info ms-1">cle reponses</span>{{/answerKeyAvailable}}
                        <div class="mt-2 d-flex flex-wrap gap-2">
                            {{#downloads}}
                            <a class="btn btn-outline-secondary btn-sm" href="{{path}}" download>{{label}} ({{extension}})</a>
                            {{/downloads}}
                        </div>
                    </li>
                    {{/annalesSeries}}
                </ul>
            </div>
        </article>
    </aside>
</div>

<script>
(() => {
    const root = document.querySelector('[data-module-checklist="{{id}}"]');
    if (!root) return;
    const key = 'sitepe_checklist_module_{{id}}';
    const checked = new Set(JSON.parse(localStorage.getItem(key) || '[]'));
    root.querySelectorAll('.module-check-item').forEach((input) => {
        const index = String(input.dataset.checkIndex || '');
        input.checked = checked.has(index);
        input.addEventListener('change', () => {
            if (input.checked) checked.add(index);
            else checked.delete(index);
            localStorage.setItem(key, JSON.stringify([...checked]));
        });
    });
})();
</script>
